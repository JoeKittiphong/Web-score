<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ระบบจัดการคะแนนหลายวิชา</title>
<style>
    body {
        font-family: sans-serif;
        margin: 0;
        background: #f4f4f4;
        padding: 20px;
    }
    h1, h2 {
        text-align: center;
    }
    .container {
        max-width: 600px;
        margin: auto;
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .flex {
        display: flex;
        gap: 5px;
        margin-bottom: 10px;
        flex-wrap: wrap;
    }
    input, select, button {
        padding: 8px;
        font-size: 14px;
    }
    button {
        cursor: pointer;
    }
    ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    li {
        background: #f9f9f9;
        padding: 8px;
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
    .name {
        flex: 1;
        margin-right: 5px;
    }
    .score {
        width: 50px;
        text-align: center;
    }
    .btn {
        padding: 5px 8px;
        border: none;
        border-radius: 3px;
        color: white;
    }
    .add { background: #4CAF50; }
    .sub { background: #f44336; }
    .del { background: #888; }
    .subject-btn {
        background: #2196F3;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 5px 10px;
    }
</style>
</head>
<body>

<div class="container">
    <h1>ระบบจัดการหลายเจ้ามือ</h1>

    <!-- เลือกวิชา -->
    <div class="flex">
        <select id="subjectSelect"></select>
        <input type="text" id="newSubject" placeholder="ชื่อวิชาใหม่">
        <button class="subject-btn" onclick="addSubject()">เพิ่มเจ้ามือ</button>
    </div>

    <!-- คะแนนกลาง -->
    <div class="flex">
        <label>คะแนนกลาง: </label>
        <input type="number" id="scoreStep" value="20">
    </div>

    <!-- เพิ่มผู้เล่น -->
    <div class="flex">
        <input type="text" id="playerName" placeholder="ชื่อผู้เล่น">
        <button onclick="addPlayer()">เพิ่ม</button>
    </div>

    <!-- รายชื่อผู้เล่น -->
    <ul id="playerList"></ul>
</div>

<script>
let subjects = JSON.parse(localStorage.getItem('subjects')) || [
    { name: "เจ้ามือคนแรก", players: [] }
];
let currentSubjectIndex = 0;
let draggedIndex = null;

function saveData() {
    localStorage.setItem('subjects', JSON.stringify(subjects));
}

function renderSubjects() {
    const select = document.getElementById('subjectSelect');
    select.innerHTML = "";
    subjects.forEach((subj, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = subj.name;
        if (index === currentSubjectIndex) option.selected = true;
        select.appendChild(option);
    });
    renderPlayers();
}

document.getElementById('subjectSelect').addEventListener('change', (e) => {
    currentSubjectIndex = parseInt(e.target.value);
    renderPlayers();
});

function addSubject() {
    const name = document.getElementById('newSubject').value.trim();
    if (!name) return;
    subjects.push({ name, players: [] });
    document.getElementById('newSubject').value = "";
    currentSubjectIndex = subjects.length - 1;
    saveData();
    renderSubjects();
}

function addPlayer() {
    const name = document.getElementById('playerName').value.trim();
    if (!name) return;
    subjects[currentSubjectIndex].players.push({ name, score: 0 });
    document.getElementById('playerName').value = "";
    saveData();
    renderPlayers();
}

function renderPlayers() {
    const list = document.getElementById('playerList');
    list.innerHTML = "";
    subjects[currentSubjectIndex].players.forEach((player, index) => {
        const li = document.createElement('li');
        li.draggable = true;

        // รองรับ drag & drop บนมือถือ
        li.addEventListener('touchstart', () => draggedIndex = index);
        li.addEventListener('touchend', (e) => {
            const target = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
            if (target && target.tagName === 'LI') {
                const dropIndex = [...list.children].indexOf(target);
                movePlayer(draggedIndex, dropIndex);
            }
        });

        // รองรับ drag & drop บนคอม
        li.addEventListener('dragstart', () => draggedIndex = index);
        li.addEventListener('dragover', (e) => e.preventDefault());
        li.addEventListener('drop', () => movePlayer(draggedIndex, index));

        li.innerHTML = `
            <input class="name" value="${player.name}" onchange="editName(${index}, this.value)">
            <span class="score">${player.score}</span>
            <button class="btn add" onclick="changeScore(${index}, 1)">ได้</button>
            <button class="btn sub" onclick="changeScore(${index}, -1)">เสีย</button>
            <button class="btn del" onclick="deletePlayer(${index})">ลบ</button>
        `;
        list.appendChild(li);
    });
}

function editName(index, newName) {
    subjects[currentSubjectIndex].players[index].name = newName;
    saveData();
}

function changeScore(index, direction) {
    const step = parseInt(document.getElementById('scoreStep').value) || 1;
    subjects[currentSubjectIndex].players[index].score += direction * step;
    saveData();
    renderPlayers();
}

function deletePlayer(index) {
    if (confirm("คุณแน่ใจหรือไม่ว่าต้องการลบรายชื่อนี้?")) {
        subjects[currentSubjectIndex].players.splice(index, 1);
        saveData();
        renderPlayers();
    }
}

function movePlayer(fromIndex, toIndex) {
    if (fromIndex === toIndex) return;
    const arr = subjects[currentSubjectIndex].players;
    const [moved] = arr.splice(fromIndex, 1);
    arr.splice(toIndex, 0, moved);
    saveData();
    renderPlayers();
}

renderSubjects();
</script>

</body>
</html>
